<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Edit Announcements</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Ubuntu', Arial, sans-serif; background: #f0f4fa; color: #222; margin: 0; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 8px 32px rgba(0,0,0,0.12); padding: 32px; }
    h1 { text-align: center; color: #001489; }
    .login-box { max-width: 350px; margin: 80px auto; background: #fff; border-radius: 10px; box-shadow: 0 8px 32px rgba(0,0,0,0.12); padding: 32px; }
    label { font-weight: 600; }
    input[type="text"], input[type="password"] { width: 100%; padding: 10px; margin: 8px 0 16px 0; border-radius: 6px; border: 1px solid #bbb; }
    button { background: #001489; color: #fff; border: none; border-radius: 6px; padding: 10px 24px; font-size: 1em; font-weight: 600; cursor: pointer; margin-top: 8px; }
    button:hover { background: #003ab8; }
    .section { margin-bottom: 32px; }
    .section h2 { color: #003ab8; margin-bottom: 12px; }
    .item-list { margin-bottom: 12px; }
    .item { background: #f7f9fc; border-radius: 6px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .item input, .item textarea { width: 100%; margin: 0 8px; }
    .item-actions button { margin-left: 8px; }
    .template-select { margin-bottom: 12px; }
    .logout { float: right; color: #003ab8; cursor: pointer; font-size: 0.95em; }
    .logout:hover { text-decoration: underline; }
    .add-btn { margin-top: 8px; }
    .no-meeting-btn { background: #FFCD00; color: #222; }
  </style>
</head>
<body>
  <div id="login" class="login-box">
    <h2>Admin Login</h2>
    <label for="username">Username</label>
    <input type="text" id="username" autocomplete="username" />
    <label for="password">Password</label>
    <input type="password" id="password" autocomplete="current-password" />
    <button onclick="login()">Login</button>
    <div id="login-error" style="color: red; margin-top: 10px;"></div>
  </div>
  <div id="admin" class="container" style="display:none;">
    <span class="logout" onclick="logout()">Logout</span>
    <h1>Edit Announcements</h1>
    <!-- Template Preview Area -->
    <div style="margin-bottom:24px; padding:18px 16px; background:#f7f9fc; border-radius:8px; border:1px solid #e0e0e0;">
      <h2 style="margin-top:0; font-size:1.2em; color:#003ab8;">Template Preview</h2>
      <div style="margin-bottom:10px;">
        <strong>Meeting Templates:</strong>
        <button type="button" onclick="previewTemplate('meeting','card')">Card</button>
        <button type="button" onclick="previewTemplate('meeting','simple')">Simple</button>
        <button type="button" onclick="previewTemplate('meeting','highlight')">Highlight</button>
      </div>
      <div style="margin-bottom:10px;">
        <strong>Opportunity Templates:</strong>
        <button type="button" onclick="previewTemplate('opportunity','card')">Card</button>
        <button type="button" onclick="previewTemplate('opportunity','simple')">Simple</button>
        <button type="button" onclick="previewTemplate('opportunity','highlight')">Highlight</button>
      </div>
      <div style="margin-bottom:10px;">
        <strong>Announcement Templates:</strong>
        <button type="button" onclick="previewTemplate('announcement','card')">Card</button>
        <button type="button" onclick="previewTemplate('announcement','simple')">Simple</button>
        <button type="button" onclick="previewTemplate('announcement','highlight')">Highlight</button>
      </div>
      <div id="template-preview-box" style="margin-top:18px; min-height:60px;"></div>
    </div>
    <label style="display:block;margin-bottom:12px;"><input type="checkbox" id="view-css-toggle" onchange="toggleViewCSS()"> View as Inline CSS (Preview)</label>
    <form id="editor-form" autocomplete="off">
          // --- Template Preview Logic ---
          function previewTemplate(type, style) {
            let html = '';
            if (type === 'meeting') {
              const sample = {
                date: '15 Dec', title: 'Emergency Services', location: 'EKX', uod: 'ABU/OCPs', details: 'TBA', cadets: 'C/CMSgt Fruth', am: 'Capt Threadgill', template: style
              };
              html = renderMeeting(sample);
            } else if (type === 'opportunity') {
              const sample = {
                title: 'sUAS Course', openTo: 'All Members', details: 'Learn to fly drones!', link: 'https://example.com', linkText: 'Learn More', template: style
              };
              html = renderOpportunity(sample);
            } else if (type === 'announcement') {
              const sample = {
                title: '2026 OHWG Encampment', details: 'Cadet cadre applications open. Deadline: Jan 23.', template: style
              };
              html = renderAnnouncement(sample);
            }
            document.getElementById('template-preview-box').innerHTML = html;
          }
      <!-- Meetings Section -->
      <div class="section">
        <h2>Upcoming Squadron Meetings</h2>
        <div class="item-list" id="meetings-list"></div>
        <div id="meetings-preview" style="display:none;"></div>
        <button type="button" class="add-btn" onclick="addMeeting()">Add Meeting</button>
        <button type="button" class="add-btn no-meeting-btn" onclick="addNoMeeting()">Add No Meeting Placeholder</button>
      </div>
      <!-- General Info Section -->
      <div class="section">
        <h2>General Squadron Information</h2>
        <textarea id="general-info" rows="3" style="width:100%;"></textarea>
        <div id="general-preview" style="display:none;"></div>
      </div>
      <!-- Opportunities Section -->
      <div class="section">
        <h2>Ongoing Opportunities</h2>
        <div class="item-list" id="opportunities-list"></div>
        <div id="opportunities-preview" style="display:none;"></div>
        <button type="button" class="add-btn" onclick="addOpportunity()">Add Opportunity</button>
      </div>
      <!-- Wing Announcements Section -->
      <div class="section">
        <h2>Wing & Higher Command Announcements</h2>
        <div class="item-list" id="wing-list"></div>
        <div id="wing-preview" style="display:none;"></div>
        <button type="button" class="add-btn" onclick="addWing()">Add Announcement</button>
      </div>
      <button type="submit" style="margin-top:16px;">Save Changes</button>
    </form>
  </div>
  <script>
    // --- JSONBin.io Config ---
    const JSONBIN_API_KEY = '$2a$10$9rN8sOAMIElDRuxOLr/uSuAO8rzPf.w.bx1nNtwO/0gW6yHbdykSi'; // <-- Replace with your JSONBin.io secret key
    const JSONBIN_BIN_ID = '6941bfa5d0ea881f402e1335';   // <-- Replace with your Bin ID
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

    // --- Login Logic ---
    function login() {
      const u = document.getElementById('username').value;
      const p = document.getElementById('password').value;
      if (u === 'admin' && p === 'admin123') {
        sessionStorage.setItem('admin', '1');
        document.getElementById('login').style.display = 'none';
        document.getElementById('admin').style.display = 'block';
        loadEditor();
      } else {
        document.getElementById('login-error').innerText = 'Invalid username or password.';
      }
    }
    function logout() {
      sessionStorage.removeItem('admin');
      document.getElementById('admin').style.display = 'none';
      document.getElementById('login').style.display = 'block';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('login-error').innerText = '';
    }

    // --- Data Logic (JSONBin.io) ---
    async function getData() {
      try {
        const res = await fetch(JSONBIN_URL + '/latest', {
          headers: { 'X-Master-Key': JSONBIN_API_KEY }
        });
        if (!res.ok) throw new Error('Failed to fetch data');
        const json = await res.json();
        return json.record;
      } catch (e) {
        // fallback to empty
        return { meetings: [], general: '', opportunities: [], wing: [] };
      }
    }
    async function setDataRemote(data) {
      await fetch(JSONBIN_URL, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': JSONBIN_API_KEY
        },
        body: JSON.stringify(data)
      });
    }

    // --- Editor UI Logic ---
    let data = { meetings: [], general: '', opportunities: [], wing: [] };
    async function loadEditor() {
      data = await getData();
      // Meetings
      const meetingsList = document.getElementById('meetings-list');
      meetingsList.innerHTML = '';
      data.meetings.forEach((m, i) => {
        let templateSel = `<select onchange='editMeeting(${i}, "template", this.value)'>
          <option value='card'${m.template==="card"||!m.template?" selected":""}>Card</option>
          <option value='simple'${m.template==="simple"?" selected":""}>Simple</option>
          <option value='highlight'${m.template==="highlight"?" selected":""}>Highlight</option>
        </select>`;
        if (m.noMeeting) {
          meetingsList.innerHTML += `<div class='item'>NO MEETING ${templateSel}<span class='item-actions'><button onclick='deleteMeeting(${i})'>Delete</button></span></div>`;
        } else {
          meetingsList.innerHTML += `<div class='item'>
            <input value='${m.date||''}' placeholder='Date' onchange='editMeeting(${i}, "date", this.value)' />
            <input value='${m.title||''}' placeholder='Title' onchange='editMeeting(${i}, "title", this.value)' />
            <input value='${m.location||''}' placeholder='Location' onchange='editMeeting(${i}, "location", this.value)' />
            <input value='${m.uod||''}' placeholder='UOD' onchange='editMeeting(${i}, "uod", this.value)' />
            <input value='${m.details||''}' placeholder='Details' onchange='editMeeting(${i}, "details", this.value)' />
            <input value='${m.cadets||''}' placeholder='Cadets' onchange='editMeeting(${i}, "cadets", this.value)' />
            <input value='${m.am||''}' placeholder='Primary AM' onchange='editMeeting(${i}, "am", this.value)' />
            ${templateSel}
            <span class='item-actions'><button onclick='deleteMeeting(${i})'>Delete</button></span>
          </div>`;
        }
      });
      // General Info
      document.getElementById('general-info').value = data.general || '';
      // Opportunities
      const oppList = document.getElementById('opportunities-list');
      oppList.innerHTML = '';
      data.opportunities.forEach((o, i) => {
        let templateSel = `<select onchange='editOpportunity(${i}, "template", this.value)'>
          <option value='card'${o.template==="card"||!o.template?" selected":""}>Card</option>
          <option value='simple'${o.template==="simple"?" selected":""}>Simple</option>
          <option value='highlight'${o.template==="highlight"?" selected":""}>Highlight</option>
        </select>`;
        oppList.innerHTML += `<div class='item'>
          <input value='${o.title||''}' placeholder='Title' onchange='editOpportunity(${i}, "title", this.value)' />
          <input value='${o.openTo||''}' placeholder='Open to' onchange='editOpportunity(${i}, "openTo", this.value)' />
          <input value='${o.details||''}' placeholder='Details' onchange='editOpportunity(${i}, "details", this.value)' />
          <input value='${o.link||''}' placeholder='Link' onchange='editOpportunity(${i}, "link", this.value)' />
          <input value='${o.linkText||''}' placeholder='Link Text' onchange='editOpportunity(${i}, "linkText", this.value)' />
          ${templateSel}
          <span class='item-actions'><button onclick='deleteOpportunity(${i})'>Delete</button></span>
        </div>`;
      });
      // Wing Announcements
      const wingList = document.getElementById('wing-list');
      wingList.innerHTML = '';
      data.wing.forEach((w, i) => {
        let templateSel = `<select onchange='editWing(${i}, "template", this.value)'>
          <option value='card'${w.template==="card"||!w.template?" selected":""}>Card</option>
          <option value='simple'${w.template==="simple"?" selected":""}>Simple</option>
          <option value='highlight'${w.template==="highlight"?" selected":""}>Highlight</option>
        </select>`;
        wingList.innerHTML += `<div class='item'>
          <input value='${w.title||''}' placeholder='Title' onchange='editWing(${i}, "title", this.value)' />
          <input value='${w.details||''}' placeholder='Details' onchange='editWing(${i}, "details", this.value)' />
          ${templateSel}
          <span class='item-actions'><button onclick='deleteWing(${i})'>Delete</button></span>
        </div>`;
      });
    }

    // --- Meetings CRUD ---
    async function addMeeting() {
      data.meetings.push({ date: '', title: '', location: '', uod: '', details: '', cadets: '', am: '' });
      await setDataRemote(data);
      loadEditor();
    }
    async function addNoMeeting() {
      data.meetings.push({ noMeeting: true });
      await setDataRemote(data);
      loadEditor();
    }
    async function editMeeting(i, field, value) {
      data.meetings[i][field] = value;
      await setDataRemote(data);
    }
    async function deleteMeeting(i) {
      data.meetings.splice(i, 1);
      await setDataRemote(data);
      loadEditor();
    }
    // --- General Info ---
    document.getElementById('general-info').addEventListener('input', async function() {
      data.general = this.value;
      await setDataRemote(data);
    });
    // --- Opportunities CRUD ---
    async function addOpportunity() {
      data.opportunities.push({ title: '', openTo: '', details: '', link: '', linkText: '' });
      await setDataRemote(data);
      loadEditor();
    }
    async function editOpportunity(i, field, value) {
      data.opportunities[i][field] = value;
      await setDataRemote(data);
    }
    async function deleteOpportunity(i) {
      data.opportunities.splice(i, 1);
      await setDataRemote(data);
      loadEditor();
    }
    // --- Wing Announcements CRUD ---
    async function addWing() {
      data.wing.push({ title: '', details: '' });
      await setDataRemote(data);
      loadEditor();
    }
    async function editWing(i, field, value) {
      data.wing[i][field] = value;
      await setDataRemote(data);
    }
    async function deleteWing(i) {
      data.wing.splice(i, 1);
      await setDataRemote(data);
      loadEditor();
    }
    // --- Save All ---
    document.getElementById('editor-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      await setDataRemote(data);
      alert('Announcements updated!');
    });

    // --- On load, if already logged in, show admin ---
    if (sessionStorage.getItem('admin') === '1') {
      document.getElementById('login').style.display = 'none';
      document.getElementById('admin').style.display = 'block';
      loadEditor();
    }
    function renderMeeting(m) {
      const t = m.template || 'card';
      if (m.noMeeting) {
        if (t === 'highlight') {
          return `<div class=\"meeting no-meeting\" style=\"background:linear-gradient(135deg,#fff3cd 0%,#fffbea 100%);border-left:5px solid #FFCD00;text-align:center;font-size:1.3em;font-weight:800;color:#856404;box-shadow:0 4px 15px rgba(0,0,0,0.08);\">NO MEETING</div>`;
        }
        // default
        return `<div class=\"meeting no-meeting\">NO MEETING</div>`;
      }
      if (t === 'card') {
        return `<div class=\"meeting\"><h3>${m.date} - ${m.title}</h3><div><strong>Location:</strong> ${m.location}</div><div><strong>UOD:</strong> ${m.uod}</div><div><strong>Details:</strong> ${m.details}</div><div><strong>Cadets:</strong> ${m.cadets}</div><div><strong>Primary AM:</strong> ${m.am}</div></div>`;
      } else if (t === 'simple') {
        return `<div class=\"meeting\" style=\"background:#f4f8ff;border-left:3px solid #003ab8;\"><strong>${m.date}:</strong> ${m.title} (${m.location})</div>`;
      } else if (t === 'highlight') {
        return `<div class=\"meeting\" style=\"background:linear-gradient(135deg,#e0ffe0 0%,#f9fff9 100%);border-left:5px solid #28a745;\"><h3 style=\"color:#28a745;\">${m.title}</h3><div><strong>Date:</strong> ${m.date}</div><div><strong>Location:</strong> ${m.location}</div></div>`;
      }
      return `<div class=\"meeting\">${m.title}</div>`;
    }
    function renderOpportunity(o) {
      const t = o.template || 'card';
      if (t === 'card') {
        return `<div class=\"opportunity\"><h3>${o.title}</h3><div><strong>Open to:</strong> ${o.openTo}</div><div>${o.details}</div>${o.link ? `<div><a href=\"${o.link}\" target=\"_blank\">${o.linkText}</a></div>` : ''}</div>`;
      } else if (t === 'simple') {
        return `<div class=\"opportunity\" style=\"background:#f4f8ff;border-left:3px solid #003ab8;\"><strong>${o.title}</strong> - ${o.details}</div>`;
      } else if (t === 'highlight') {
        return `<div class=\"opportunity\" style=\"background:linear-gradient(135deg,#fffbe0 0%,#fff9e6 100%);border-left:5px solid #FFCD00;\"><h3 style=\"color:#FFCD00;\">${o.title}</h3><div>${o.details}</div></div>`;
      }
      return `<div class=\"opportunity\">${o.title}</div>`;
    }
    function renderAnnouncement(w) {
      const t = w.template || 'card';
      if (t === 'card') {
        return `<div class=\"announcement\"><h3>${w.title}</h3><div>${w.details}</div></div>`;
      } else if (t === 'simple') {
        return `<div class=\"announcement\" style=\"background:#f4f8ff;border-left:3px solid #003ab8;\"><strong>${w.title}:</strong> ${w.details}</div>`;
      } else if (t === 'highlight') {
        return `<div class=\"announcement\" style=\"background:linear-gradient(135deg,#ffe0e0 0%,#fff9f9 100%);border-left:5px solid #BA0C2F;\"><h3 style=\"color:#BA0C2F;\">${w.title}</h3><div>${w.details}</div></div>`;
      }
      return `<div class=\"announcement\">${w.title}</div>`;
    }
    function toggleViewCSS() {
      const checked = document.getElementById('view-css-toggle').checked;
      document.getElementById('meetings-list').style.display = checked ? 'none' : '';
      document.getElementById('opportunities-list').style.display = checked ? 'none' : '';
      document.getElementById('wing-list').style.display = checked ? 'none' : '';
      document.getElementById('general-info').style.display = checked ? 'none' : '';
      document.getElementById('meetings-preview').style.display = checked ? '' : 'none';
      document.getElementById('opportunities-preview').style.display = checked ? '' : 'none';
      document.getElementById('wing-preview').style.display = checked ? '' : 'none';
      document.getElementById('general-preview').style.display = checked ? '' : 'none';
      if (checked) renderPreviews();
    }
    function renderPreviews() {
      // Meetings
      document.getElementById('meetings-preview').innerHTML = data.meetings.map(renderMeeting).join('');
      // General
      document.getElementById('general-preview').innerHTML = `<div class='meeting'>${data.general}</div>`;
      // Opportunities
      document.getElementById('opportunities-preview').innerHTML = data.opportunities.map(renderOpportunity).join('');
      // Wing
      document.getElementById('wing-preview').innerHTML = data.wing.map(renderAnnouncement).join('');
    }
  </script>
</body>
</html>
